<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="None">
        <meta name="author" content="Sylvain Renevey">
        <link rel="canonical" href="https://srenevey.github.io/ode-solvers/index.html">
        <link rel="shortcut icon" href="img/favicon.ico">
        <title>Ode-solvers Docs</title>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/font-awesome.min.css" rel="stylesheet">
        <link href="css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/docco.min.css">

        <script src="js/jquery-1.10.2.min.js" defer></script>
        <script src="js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body class="homepage">
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="index.html">Ode-solvers Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem active">
                                <a href="index.html" class="nav-link">Quick reference</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="examples/kepler_orbit.html" class="dropdown-item">Kepler Orbit</a>
</li>
                                    
<li>
    <a href="examples/three_body_problem.html" class="dropdown-item">Three-body Problem</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="https://docs.rs/ode_solvers/" class="nav-link">API documentation</a>
                            </li>
                            <li class="navitem">
                                <a href="changelog.html" class="nav-link">Changelog</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" class="nav-link disabled">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="examples/kepler_orbit.html" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/srenevey/ode-solvers" class="nav-link"><i class="fa fa-github"></i> GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#odes-solving-in-rust" class="nav-link">ODEs Solving in Rust</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#installation" class="nav-link">Installation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#type-alias-definition" class="nav-link">Type alias definition</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#system-definition" class="nav-link">System definition</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#method-selection" class="nav-link">Method selection</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#adaptive-step-size" class="nav-link">Adaptive Step Size</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#references" class="nav-link">References</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="odes-solving-in-rust">ODEs Solving in Rust</h1>
<p>Ode-solvers is a collection of numerical methods to solve ordinary differential equations (ODEs) in Rust. The following instructions should get you up and running in no time. See the examples and the API documentation for more details.</p>
<h2 id="installation">Installation</h2>
<p>To start using the crate in your project, add the following dependency in your project's Cargo.toml file:</p>
<pre><code class="language-rust">[dependencies]
ode_solvers = &quot;0.5.x&quot;
</code></pre>
<p>Then, in your main file, add</p>
<pre><code class="language-rust">use ode_solvers::*;
</code></pre>
<h2 id="type-alias-definition">Type alias definition</h2>
<p>The numerical integration methods implemented in the crate support multi-dimensional systems. In order to define the dimension of the system, declare a type alias for the state vector. For instance</p>
<pre><code class="language-rust">type State = Vector3&lt;f64&gt;;
</code></pre>
<p>The state representation of the system is based on the SVector&lt;T, D&gt; structure defined in the <a href="https://nalgebra.org/">nalgebra</a> crate. For convenience, ode-solvers re-exports six types to work with systems of dimension 1 to 6: Vector1&lt;T&gt;,..., Vector6&lt;T&gt;. For higher dimensions, the user should import the nalgebra crate and define a SVector&lt;T, D&gt;  where the second type parameter of SVector is a dimension. For instance, for a 9-dimensional system, one would have:</p>
<pre><code class="language-rust">type State = SVector&lt;f64, 9&gt;;
</code></pre>
<p>Alternativly, one can also use the DVector&lt;T&gt; structure from the <a href="https://nalgebra.org/">nalgebra</a> crate as the state representation. When using a DVector&lt;T&gt;, the number of rows in the DVector&lt;T&gt; defines the dimension of the system.</p>
<pre><code class="language-rust">type State = DVector&lt;f64&gt;;
</code></pre>
<h2 id="system-definition">System definition</h2>
<p>The system of first order ODEs must be defined in the <code>system</code> method of the <code>System&lt;T, V&gt;</code> trait. Typically, this trait is defined for a structure containing some parameters of the model. The signature of the <code>System&lt;T, V&gt;</code> trait is:</p>
<pre><code class="language-rust">pub trait System&lt;T, V&gt; {
    fn system(&amp;self, x: T, y: &amp;V, dy: &amp;mut V);
    fn solout(&amp;self, _x: T, _y: &amp;V, _dy: &amp;V) -&gt; bool {
        false
    }
}
</code></pre>
<p>where <code>system</code> must contain the ODEs: the second argument is the independent variable (usually time), the third one is a vector containing the dependent variable(s), and the fourth one contains the derivative(s) of y with respect to x. The method <code>solout</code> is called after each successful integration step and stops the integration whenever it is evaluated as true. The implementation of that method is optional. See the examples for implementation details.</p>
<h2 id="method-selection">Method selection</h2>
<p>The following explicit Runge-Kutta methods are implemented in the current version of the crate:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Name</th>
<th>Order</th>
<th>Error estimate order</th>
<th>Dense output order</th>
</tr>
</thead>
<tbody>
<tr>
<td>Runge-Kutta 4</td>
<td>Rk4</td>
<td>4</td>
<td>N/A</td>
<td>N/A</td>
</tr>
<tr>
<td>Dormand-Prince</td>
<td>Dopri5</td>
<td>5</td>
<td>4</td>
<td>4</td>
</tr>
<tr>
<td>Dormand-Prince</td>
<td>Dop853</td>
<td>8</td>
<td>(5, 3)</td>
<td>7</td>
</tr>
</tbody>
</table>
<p>These methods are defined in the modules rk4, dopri5, and dop853. The Dormand-Prince methods feature: </p>
<ul>
<li>Adaptive step size control</li>
<li>Automatic initial step size selection</li>
<li>Automatic stiffness detection</li>
<li>Sparse or dense output</li>
</ul>
<p>The first step is to bring the desired module into scope:</p>
<pre><code class="language-rust">use ode_solvers::dopri5::*;
</code></pre>
<p>Then, a structure is created using the <code>new</code> or the <code>from_param</code> method of the corresponding struct. Refer to the <a href="https://docs.rs/ode_solvers">API documentation</a> for a description of the input arguments.</p>
<pre><code class="language-rust">let mut stepper = Dopri5::new(system, x0, x_end, dx, y0, rtol, atol);
</code></pre>
<p>The system is integrated using</p>
<pre><code class="language-rust">let res = stepper.integrate();
</code></pre>
<p>which returns Result&lt;Stats, IntegrationError&gt;. Upon successful completion, res = Ok(Stats) where Stats is a structure containing some information on the integration process (such as number of function evaluations). If an error occurs, res = Err(IntegrationError). Finally, the results can be retrieved with</p>
<pre><code class="language-rust">let x_out = stepper.x_out();
let y_out = stepper.y_out();
</code></pre>
<h2 id="adaptive-step-size">Adaptive Step Size</h2>
<p>The adaptive step size used in Dopri5 and Dop853 is computed using a PI controller</p>
<p><center><script type="math/tex; mode=display">h_{n+1} = h_ns|err_n|^{-\alpha}|err_{n-1}|^\beta</script></center></p>
<p>where <script type="math/tex">s​</script> is a safety factor, <script type="math/tex">|err_n|</script> is the current error , and <script type="math/tex">|err_{n-1}|</script> is the previous error. The coefficients <script type="math/tex">\alpha</script> and <script type="math/tex">\beta</script> determine the behavior of the controller. In order to make sure that <script type="math/tex">h</script> doesn't change too abruptly, bounds on the factor of <script type="math/tex">h_n</script> are enforced:</p>
<p><center><script type="math/tex; mode=display">f_{min} \leq s|err_n|^{-\alpha}|err_{n-1}|^\beta \leq f_{max}</script></center></p>
<p>If <script type="math/tex">s|err_n|^{-\alpha}|err_{n-1}|^\beta \leq f_{min}​</script>, then ​<script type="math/tex">h_{n+1} = h_nf_{min}</script> and if <script type="math/tex">s|err_n|^{-\alpha}|err_{n-1}|^\beta \geq f_{max}</script>, <script type="math/tex">h_{n+1} = h_nf_{max}</script>.</p>
<p>The default values of these parameters are listed in the table below.</p>
<table>
<thead>
<tr>
<th></th>
<th>Dopri5</th>
<th>Dop853</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<script type="math/tex">\alpha​</script>
</td>
<td>0.17</td>
<td>1/8</td>
</tr>
<tr>
<td>
<script type="math/tex">\beta​</script>
</td>
<td>0.04</td>
<td>0</td>
</tr>
<tr>
<td>
<script type="math/tex">f_{min}​</script>
</td>
<td>0.2</td>
<td>0.333</td>
</tr>
<tr>
<td>
<script type="math/tex">f_{max}​</script>
</td>
<td>10.0</td>
<td>6.0</td>
</tr>
<tr>
<td>
<script type="math/tex">s​</script>
</td>
<td>0.9</td>
<td>0.9</td>
</tr>
</tbody>
</table>
<p>These default values can be overridden by using the method <code>from_param</code>.</p>
<p>For Dopri5, a 5th order approximation <script type="math/tex">y_1</script> ​and a 4th order approximation <script type="math/tex">\hat{y}_1</script> are constructed using the coefficients of the method. The error estimator is then</p>
<p><center><script type="math/tex; mode=display">err=\sqrt{\frac{1}{n}\sum_{i=1}^n\frac{y_{1i}-\hat{y}_{1i}}{sc_i}}</script></center></p>
<p>where <script type="math/tex">n​</script> is the dimension of the system and <script type="math/tex">sc_i</script> is a scale factor given by</p>
<p><center><script type="math/tex; mode=display">sc_i=a_{tol}+r_{tol}\max{(|y_{0i}|,|y_{1i}|)}</script></center></p>
<p>For Dop853, an 8th order approximation <script type="math/tex">y_1​</script>, a 5th order approximation <script type="math/tex">\hat{y}_1</script>, and a 3rd order approximation <script type="math/tex">\tilde{y}_1​</script> are constructed using the coefficients of the method. Two error estimators are computed:</p>
<p><center><script type="math/tex; mode=display">err_{5}=\sqrt{\frac{1}{n}\sum_{i=1}^n\frac{y_{1i}-\hat{y}_{1i}}{sc_i}}</script> &nbsp; and &nbsp;  <script type="math/tex; mode=display">err_{3}=\sqrt{\frac{1}{n}\sum_{i=1}^n\frac{y_{1i}-\tilde{y}_{1i}}{sc_i}}</script></center></p>
<p>which are combined into a single error estimator</p>
<p><center><script type="math/tex; mode=display">err=err_5\frac{err_5}{\sqrt{err_5^2+0.01err_3^2}}</script></center></p>
<p>For a thorough discussion, see Hairer et al. [1].</p>
<h2 id="references">References</h2>
<p>[1] Hairer, E., Nørsett, S.P., Wanner, G., <em>Solving Ordinary Differential Equations I, Nonstiff Problems</em>, Second Revised Edition, Springer, 2008</p>
<p>[2] Hairer, E., Wanner, G., <em>Solving Ordinary Differential Equations II, Stiff and Differential-Algebraic Problems</em>, Second Revised Edition, Springer, 2002</p>
<p>[3] Butcher, J.C., <em>Numerical Methods for Ordinary Differential Equations</em>, Third Edition, John Wiley and Sons, 2016</p>
<p>[4] Gustafsson, K., Control-Theoretic Techniques for Stepsize Selection in Explicit Runge-Kutta Methods. <em>ACM Transactions on Mathematical Software</em>, 17, 4 (December 1991), 533-554.</p>
<p>[5] Gustafsson, K., Control-Theoretic Techniques for Stepsize Selection in Implicit Runge-Kutta Methods. <em>ACM Transactions on Mathematical Software</em>, 20, 4 (December 1994), 496-517. </p>
<p>[6] Söderlind, G., Automatic Control and Adaptive Time-Stepping, <em>Numerical Algorithms</em> (2002) 31: 281-310.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = ".",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
        <script src="search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>

<!--
MkDocs version : 1.3.1
Build Date UTC : 2024-10-26 23:05:52.357164+00:00
-->
