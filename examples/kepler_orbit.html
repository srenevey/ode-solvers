<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Sylvain Renevey">
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Kepler Orbit - Ode-solvers Docs</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/docco.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../index.html">Ode-solvers Docs</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../index.html">Quick reference</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li class="active">
    <a href="kepler_orbit.html">Kepler Orbit</a>
</li>
                                    
<li >
    <a href="three_body_problem.html">Three-body Problem</a>
</li>
                                </ul>
                            </li>
                            <li >
                                <a href="https://docs.rs/ode_solvers/">API documentation</a>
                            </li>
                            <li >
                                <a href="../changelog.html">Changelog</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../index.html">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="three_body_problem.html">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/srenevey/ode-solvers"><i class="fa fa-github"></i> GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#kepler-orbit">Kepler Orbit</a></li>
            <li><a href="#problem-definition">Problem Definition</a></li>
            <li><a href="#implementation">Implementation</a></li>
            <li><a href="#results">Results</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="kepler-orbit">Kepler Orbit</h1>
<h3 id="problem-definition">Problem Definition</h3>
<p>For this example, we consider a spacecraft on a Kepler orbit about the Earth and we want to predict its future trajectory. We assume that the elliptical orbit is described by the following classical orbital elements:</p>
<ul>
<li>Semi-major axis: a = 20,000 km</li>
<li>Eccentricity: e = 0.7</li>
<li>Inclination: i = 35째</li>
<li>Right ascension of the ascending node: &#937; = 100째</li>
<li>Argument of perigee: &#969; = 65째</li>
<li>True anomaly: &#957; = 30째</li>
</ul>
<p>The period of an orbit is given by <script type="math/tex">P = 2\pi\sqrt{\frac{a^3}{\mu}}</script> where  <script type="math/tex">\mu</script> is the standard gravitational parameter. For the Earth, &#956; = 398600.4354 km<sup>3</sup>/s<sup>2</sup>  and thus P = 2.8149 <script type="math/tex">\cdot</script> 10<sup>4</sup> s = 7.82 hours. The initial position of the spacecraft expressed in Cartesian coordinates is</p>
<p><center><script type="math/tex; mode=display">\mathbf{r} = \begin{bmatrix} -5007.2484 & -1444.9181 & 3628.5346 \end{bmatrix} \quad km</script></center></p>
<p>and velocity</p>
<p><center><script type="math/tex; mode=display">\mathbf{v} = \begin{bmatrix} 0.7177 & -10.2241 & 0.7482 \end{bmatrix} \quad km/s</script></center></p>
<p>such that the initial state vector is <script type="math/tex">\mathbf{s} = [\mathbf{r}, \mathbf{v}]^{T}</script>. The equations of motion describing the evolution of the system are</p>
<p><center><script type="math/tex; mode=display">\ddot{\mathbf{r}} = -\frac{\mu}{r^3}\mathbf{r}</script></center></p>
<p>where  <script type="math/tex">r</script> is the magnitude of <script type="math/tex">\mathbf{r}</script>. Since the crate handles first order ODEs, this system must be transformed into a state space form representation. An appropriate change of variables <script type="math/tex">y_1 = r_1</script>, <script type="math/tex">y_2 = r_2</script>, <script type="math/tex">y_3 = r_3</script>, <script type="math/tex">y_4 = \dot{r}_1 = v_1</script>, <script type="math/tex">y_5 = \dot{r}_2 = v_2</script>, <script type="math/tex">y_6 = \dot{r}_3 = v_3</script> yields</p>
<p>
<script type="math/tex; mode=display">\dot{y}_1 = y_4</script>
</p>
<p>
<script type="math/tex; mode=display">\dot{y}_2 = y_5</script>
</p>
<p>
<script type="math/tex; mode=display">\dot{y}_3 = y_6</script>
</p>
<p>
<script type="math/tex; mode=display">\dot{y}_4 = -\frac{\mu}{r^3}y_1</script>
</p>
<p>
<script type="math/tex; mode=display">\dot{y}_5 = -\frac{\mu}{r^3}y_2</script>
</p>
<p>
<script type="math/tex; mode=display">\dot{y}_6 = -\frac{\mu}{r^3}y_3</script>
</p>
<p>which can be numerically integrated.</p>
<h3 id="implementation">Implementation</h3>
<p>The problem is solved using the Dopri5 method. We first import the crate and bring the required modules into scope:</p>
<pre><code class="rust">use ode_solvers::dopri5::*;
use ode_solvers::*;
</code></pre>

<p>Next, two type aliases are defined:</p>
<pre><code class="rust">type State = Vector6&lt;f64&gt;;
type Time = f64;
</code></pre>

<p>and a structure containing the parameters of the model is created:</p>
<pre><code class="rust">struct KeplerOrbit {
  mu: f64,
}
</code></pre>

<p>The <code>System&lt;V&gt;</code> trait is then implemented for <code>KeplerOrbit</code>:</p>
<pre><code class="rust">impl ode_solvers::System&lt;State&gt; for KeplerOrbit {
    // Equations of motion of the system
    fn system(&amp;self, _t: Time, y: &amp;State, dy: &amp;mut State) {
        let r = (y[0] * y[0] + y[1] * y[1] + y[2] * y[2]).sqrt();

        dy[0] = y[3];
        dy[1] = y[4];
        dy[2] = y[5];
        dy[3] = - self.mu * y[0] / r.powi(3);
        dy[4] = - self.mu * y[1] / r.powi(3);
        dy[5] = - self.mu * y[2] / r.powi(3);
    }
}
</code></pre>

<p>We now implement the main function. The system of ODEs is first created with the corresponding <script type="math/tex">\mu</script> parameter. The orbital period is then computed and the initial state is initialized. The integration will be carried out using the 5th order Dormand-Prince method. Hence, a Dopri5 structure is created with the <code>system</code> structure, the initial time, the final time, the time increment between two outputs, the initial state vector, the relative tolerance, and the absolute tolerance as arguments. The integration is launched by calling the method <em>integrate()</em> and the result is stored in <em>res</em>. Finally, a check on the outcome of the integration is performed and the outputs can be extracted.</p>
<pre><code class="rust">fn main() {
    let system = KeplerOrbit {mu: 398600.435436}

    let a: f64 = 20000.0;
    let period = 2.0 * PI * (a.powi(3) / system.mu).sqrt();
    let y0 = State::new(-5007.248417988539, -1444.918140151374, 3628.534606178356, 0.717716656891, -10.224093784269, 0.748229399696);

    let mut stepper = Dopri5::new(system, 0.0, 5.0 * period, 60.0, y0, 1.0e-10, 1.0e-10);
    let res = stepper.integrate();

    // Handle result
    match res {
        Ok(stats) =&gt; {
            stats.print();

            // Do something with the output...
            // let path = Path::new(&quot;./outputs/kepler_orbit_dopri5.dat&quot;); 
            // save(stepper.x_out(), stepper.y_out(), path);  
            // println!(&quot;Results saved in: {:?}&quot;, path);
        },
        Err(_) =&gt; println!(&quot;An error occured.&quot;),
    }
}
</code></pre>

<h3 id="results">Results</h3>
<p>The following figure shows the trajectory resulting from the integration. As expected, the orbit is closed.</p>
<p><center><img alt="Kepler orbit" src="images/kepler_orbit_dopri5.png" /></center></p>
<p>Some information on the integration process is provided in the stats variable:
<pre>
Number of function evaluations: 62835
Number of accepted steps: 10467
Number of rejected steps: 5
</pre></p>
<p>In order to assess the accuracy of the integration, we look at the specific orbital energy which is a constant of the motion. This specific energy is given by
<center><script type="math/tex; mode=display">\varepsilon = \frac{v^2}{2} - \frac{\mu}{r}</script></center>
where <script type="math/tex">v</script> is the amplitude of the velocity and <script type="math/tex">r</script> is the distance from the Earth's center to the spacecraft. In theory, this value is constant as long as no external force acts on the system (which is the case here). From the intial conditions, the specific energy of this orbit is 
<center><script type="math/tex; mode=display">\varepsilon_0 = -9.9650 \; km^2/s^2</script></center>
By computing <script type="math/tex">\varepsilon</script> for each time step and plotting the difference <script type="math/tex">\varepsilon_i - \varepsilon_0</script>, we obtain the following time evolution of the error:</p>
<p><center><img alt="Time evolution of the error on the specific energy" src="images/err_specific_energy_dopri5.png" /></center></p>
<p>As can be seen on this figure, the specific energy is constant up to the 9th digit after the decimal point which shows that the accuracy of the integration is quite good. A higher accuracy can be achieved by selecting smaller values for <em>rtol</em> and <em>atol</em>.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
